<!DOCTYPE html>
<html>
<head>
    <title>FixMyRide Map</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

    <style>

        body{
            background:linear-gradient(135deg,#2a1205,#3a1a08,#2a1205);
            color:white;
            margin:0;
            font-family:Arial, sans-serif;
        }

        nav{
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:18px 8%;
            background:#111;
            box-shadow:0 0 20px rgba(255,106,0,.5);
        }

        nav h2{
            color:#ff6a00;
        }

        nav a{
            color:white;
            text-decoration:none;
            margin-left:20px;
        }

        #map{
            height:85vh;
            margin:20px;
            border-radius:20px;
            overflow:hidden;
            border:2px solid rgba(255,106,0,.5);
            box-shadow:0 0 30px rgba(255,106,0,.4);
        }

        .info{
            text-align:center;
            margin-top:15px;
        }

        .info h3{
            color:#ff6a00;
        }

        .mechanic-marker{
            width:18px;
            height:18px;
            background:#ff6a00;
            border-radius:50%;
            box-shadow:0 0 15px #ff6a00,0 0 30px #ff6a00;
            animation:pulse 1.5s infinite;
        }

        .user-marker{
            width:18px;
            height:18px;
            background:#00b7ff;
            border-radius:50%;
            box-shadow:0 0 12px #00b7ff,0 0 28px #00b7ff;
            animation:radar 2s infinite;
        }

        @keyframes pulse{
            0%{transform:scale(1);}
            50%{transform:scale(1.4);}
            100%{transform:scale(1);}
        }

        @keyframes radar{
            0%{box-shadow:0 0 10px #00b7ff;}
            50%{box-shadow:0 0 28px #00b7ff,0 0 45px #00b7ff;}
            100%{box-shadow:0 0 10px #00b7ff;}
        }

        .call-btn{
            padding:8px 16px;
            border:none;
            border-radius:20px;
            background:#ff6a00;
            color:white;
            cursor:pointer;
            margin-top:8px;
        }

    </style>
</head>

<body>

<nav>
    <h2>FixMyRide</h2>
    <div>
        <a href="dashboard.php">Dashboard</a>
        <a href="select-problem.html">Change Problem</a>
        <a href="logout.php">Logout</a>
    </div>
</nav>

<div class="info">
    <h3 id="problemText"></h3>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

const map = L.map('map').setView([10.1069,76.4737],13);

L.tileLayer(
'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
{ attribution:'&copy; OpenStreetMap contributors' }
).addTo(map);

let problem = localStorage.getItem("problem");
if(problem){
    document.getElementById("problemText").innerText =
    "Selected Problem: " + problem;
}

navigator.geolocation.getCurrentPosition(pos=>{

    const userIcon = L.divIcon({
        className:"",
        html:'<div class="user-marker"></div>',
        iconSize:[18,18]
    });

    L.marker([pos.coords.latitude,pos.coords.longitude],
    {icon:userIcon})
    .addTo(map)
    .bindPopup("You are here")
    .openPopup();

});

fetch("get-mechanics.php")
.then(res=>res.json())
.then(data=>{

    data.forEach(m=>{

        const mechIcon = L.divIcon({
            className:"",
            html:'<div class="mechanic-marker"></div>',
            iconSize:[18,18]
        });

        L.marker([m.lat,m.lng],{icon:mechIcon})
        .addTo(map)
        .bindPopup(`
            <div style="color:#111;font-size:14px;">
                <b style="color:#ff6a00;font-size:16px;">
                    ${m.name}
                </b><br>

                üìû <a href="tel:${m.phone}"
                   style="color:#ff6a00;font-weight:bold;text-decoration:none;">
                   ${m.phone}
                </a><br>

                üìç ${m.address}<br>
                Problem: ${problem || "General"}<br><br>

                <button class="call-btn"
                    onclick="alert('Booking sent to ${m.name}')">
                    Book Mechanic
                </button>
            </div>
        `);

    });

});

</script>

</body>
</html>
